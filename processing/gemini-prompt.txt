*TASK:* Act as a specialized Document Processor. Your goals are:
1. **FIRST: Detect empty pages** - Check the empty percentage of the first THREE pages (Page 1, 2, and 3).
2. Execute the entire text cleaning and structural re-assembly pipeline on the raw input data and map the corrected text to the original geometric coordinates.

⚠️ **CRITICAL - TEXT OUTPUT FORMAT:**
- ALL "text" fields MUST contain readable text in their ORIGINAL SCRIPT (Devanagari for Hindi, English for English, etc.)
- DO NOT output Unicode escape sequences like \u0915\u0943\u092a\u092f\u093e
- Output the actual readable characters: कृपया, राज्यव्यवस्था, संविधान, etc.
- The JSON response must be UTF-8 encoded with human-readable text, NOT escaped Unicode

*INPUT DATA:*
1. *RAW_OCR_TEXT:* [EXTRACT TEXT FROM THE PROVIDED PAGE IMAGES]
2. *RAW_COORD_MAP:* [EXTRACT BOUNDING BOX COORDINATES FROM THE PROVIDED PAGE IMAGES]

*EMPTY PAGE DETECTION & OVERALL SUMMARY PLACEMENT (CRITICAL - PROCESS FIRST):*
⚠️ BEFORE processing any text, you MUST check the first THREE pages for emptiness:

**Step 1: Analyze Pages 1, 2, and 3**
- Calculate the empty percentage for each of the first three pages
- A page's empty percentage is the portion of the page without text/content
- Ignore watermarks and prohibited texts when calculating content

**Step 2: Determine which CASE applies:**

### CASE 1: Use existing empty page for Overall Summary (NO new page inserted)
**Condition:** Page 3 has >50% empty OR Page 2 has >50% empty

- Set "insert_blank_page": false
- Set "summary_page_position": 3 if page_3_empty_percentage > 50%, else 2
- The Overall Summary comments will be placed on this existing empty page
- NO new page is added at the start
- NO Overall Summary page is added at the end
- Page numbering remains UNCHANGED

**Priority:** Check Page 3 first. If Page 3 is >50% empty, use Page 3. Otherwise, if Page 2 is >50% empty, use Page 2.

### CASE 2: Insert new blank page at start for Overall Summary
**Condition:** Page 1 AND Page 2 both have <10% empty (both pages have significant content)

- Set "insert_blank_page": true
- Set "blank_page_position": 1
- Set "summary_page_position": 1
- **CRITICAL: Insert NEW BLANK PAGE at position 1 and renumber ALL pages**
  - NEW BLANK PAGE → becomes Page 1 (for Overall Summary)
  - Original Page 1 → becomes Page 2
  - Original Page 2 → becomes Page 3
  - Original Page 3 → becomes Page 4
  - ... and so on
- The Overall Summary comments will be placed on this new Page 1
- NO Overall Summary page is added at the end

⚠️ IMPORTANT NOTES:
- Only ONE of these two cases will apply
- The Overall Summary is NEVER added at the end of the PDF anymore
- Overall Summary is placed on either an existing empty page (Case 1) or a new first page (Case 2)

*PROHIBITED TEXTS (MUST IGNORE):*
⚠️ DO NOT include any of the following texts in the output. These are watermarks, branding, or irrelevant content that must be completely excluded:
- "theIAShub"
- "All Rights Reserved"
- "QEP"
- "Mukherjee"

Any text block containing these prohibited texts should be entirely omitted from the output JSON. Do not create entries for them.

*INSTRUCTIONS (Integrated Processing):*
1. *Contextual Correction:* Correct all misreads and spelling errors (e.g., 'gouralist' to 'generalist').
2. *Structural Re-Assembly:* Analyze broken list items, fix punctuation breaks (Rule A), and group multi-line formulas/diagrams (Rule B).
3. *Example Tagging:* Standardize all example indicators to "Eg." and integrate them seamlessly into the corrected text.


*OUTPUT GENERATION (Final Mapping):*
* Create a single valid JSON object.
* The text field must contain the *FINAL, CLEANED, and CORRECTED TEXT*.
* ⚠️ **TEXT MUST BE IN READABLE DEVANAGARI SCRIPT** (e.g., "कृपया प्रश्नों के उत्तर"), NOT Unicode escapes (e.g., "\u0915\u0943\u092a\u092f\u093e")
* The original_line_ids and coordinates must map to the original geometric anchors from the RAW_COORD_MAP.


*COORDINATE SPECIFICATIONS (CRITICAL - MUST FOLLOW):*
⚠️ ALL COORDINATES MUST BE NORMALIZED TO VALUES BETWEEN 0.0 AND 1.0 ⚠️

How to calculate normalized coordinates:
- x1_normalized = x1_pixel / image_width
- y1_normalized = y1_pixel / image_height
- x2_normalized = x2_pixel / image_width
- y2_normalized = y2_pixel / image_height

Rules:
- Origin (0.0, 0.0) is at the TOP-LEFT corner of each image
- Bottom-right corner is (1.0, 1.0)
- ALL coordinate values MUST be decimal numbers between 0.0 and 1.0
- DO NOT return raw pixel values (like 166, 821, etc.)
- DO NOT return values greater than 1.0

⚠️⚠️⚠️ CRITICAL - STRICT JSON COORDINATE FORMAT - READ CAREFULLY ⚠️⚠️⚠️

**ABSOLUTE RULES FOR COORDINATES ARRAYS:**
1. Coordinates array MUST contain EXACTLY 4 numeric values - nothing else
2. Each value MUST be a decimal number between 0.0 and 1.0
3. Format: "Coordinates": [x1, y1, x2, y2] where ALL are pure numbers
4. NEVER insert ANY text, Hindi text, English text, or any non-numeric content
5. NEVER let text from the "text" field leak into the Coordinates array
6. Each coordinate entry must be completely separate from text content

**COMMON ERROR TO AVOID - DO NOT DO THIS:**
This is WRONG (text leaked into coordinates):
```json
{
  "text": "→ शिक्षा और रोजगार के अवसरों में आरक्षण",
  "Coordinates": [
    0.22,
    0.627,
 विशेषाधिकार (Art 29, Art 30)",   <-- WRONG! Text inside coordinates!
    0.862,
    0.712
  ]
}
```

This is CORRECT (coordinates are pure numbers only):
```json
{
  "text": "→ शिक्षा और रोजगार के अवसरों में आरक्षण",
  "Coordinates": [0.22, 0.627, 0.862, 0.712]
}
```

**VALIDATION BEFORE OUTPUT:**
Before outputting each Coordinates array, verify:
✓ Exactly 4 values
✓ All values are decimal numbers (0.0 to 1.0)
✓ No text, Hindi, English, or special characters
✓ No newlines or extra content inside the array

Example of CORRECT coordinates:
  "Coordinates": [0.10, 0.05, 0.95, 0.12]  ✓ (all values are pure decimal numbers)

Examples of WRONG coordinates (NEVER DO THIS):
  "Coordinates": [166, 151, 821, 386]  ✗ (pixel values, not normalized)
  "Coordinates": [0 astounding, 0.5, 0.9, 0.12]  ✗ (INVALID - contains word)
  "Coordinates": [0.1, 0.2, विशेषाधिकार, 0.9]  ✗ (INVALID - Hindi text inside)
  "Coordinates": [0.1, 0.2, "Art 29", 0.9]  ✗ (INVALID - English text inside)
  "Coordinates": ["0.1", "0.2", "0.8", "0.9"]  ✗ (INVALID - strings instead of numbers)


### Output JSON Schema (Unified)

OUTPUT FORMAT (MANDATORY — NO DEVIATION):
{
  "empty_page_detection": {
    "page_1_empty_percentage": <0-100 number>,
    "page_2_empty_percentage": <0-100 number>,
    "page_3_empty_percentage": <0-100 number>,
    "case_applied": <1 or 2>,
    "insert_blank_page": <true/false>,
    "blank_page_position": <1 or null if no blank page inserted>,
    "summary_page_position": <page number where Overall Summary should be placed>
  },
  "Pages": [
    {
      "Page_Number": <page_number - MUST reflect NEW numbering if blank page inserted>,
      "Original_Page_Number": <original page number before any insertion, null for inserted blank>,
      "Is_Inserted_Blank": <true/false - set true ONLY for the inserted blank page>,
      "Is_Summary_Page": <true/false - set true for the page designated for Overall Summary>,
      "Blocks": [
        {
          "Block_Number": <block_number>,
          "Lines": [
            {
                "block_type": "PARAGRAPH" | "LIST_ITEM" | "FORMULA_BLOCK",
                "text": "<The final, CLEANED and structurally continuous text.>",
                "Coordinates": [x1_normalized, y1_normalized, x2_normalized, y2_normalized]
            }
          ]
        }
      ]
    }
  ]
}


IMPORTANT FOR EMPTY PAGE DETECTION AND SUMMARY PLACEMENT:

**CASE 1 Example** (Page 3 is >50% empty, use it for summary):
Condition: page_1_empty_percentage=5, page_2_empty_percentage=10, page_3_empty_percentage=75
```json
{
  "empty_page_detection": {
    "page_1_empty_percentage": 5,
    "page_2_empty_percentage": 10,
    "page_3_empty_percentage": 75,
    "case_applied": 1,
    "insert_blank_page": false,
    "blank_page_position": null,
    "summary_page_position": 3
  }
}
```
- Page numbering remains unchanged
- Page 3 will be used for Overall Summary comments
- No new page inserted

**CASE 1 Example** (Page 2 is >50% empty, use it for summary):
Condition: page_1_empty_percentage=8, page_2_empty_percentage=60, page_3_empty_percentage=20
```json
{
  "empty_page_detection": {
    "page_1_empty_percentage": 8,
    "page_2_empty_percentage": 60,
    "page_3_empty_percentage": 20,
    "case_applied": 1,
    "insert_blank_page": false,
    "blank_page_position": null,
    "summary_page_position": 2
  }
}
```
- Page numbering remains unchanged
- Page 2 will be used for Overall Summary comments
- No new page inserted

**CASE 2 Example** (Both Page 1 and Page 2 have <10% empty, insert new page):
Condition: page_1_empty_percentage=5, page_2_empty_percentage=8, page_3_empty_percentage=15
```json
{
  "empty_page_detection": {
    "page_1_empty_percentage": 5,
    "page_2_empty_percentage": 8,
    "page_3_empty_percentage": 15,
    "case_applied": 2,
    "insert_blank_page": true,
    "blank_page_position": 1,
    "summary_page_position": 1
  }
}
```
- NEW BLANK PAGE inserted at position 1
- Page 1: Page_Number=1, Original_Page_Number=null, Is_Inserted_Blank=true, Is_Summary_Page=true
- Page 2: Page_Number=2, Original_Page_Number=1
- Page 3: Page_Number=3, Original_Page_Number=2
- Page 4: Page_Number=4, Original_Page_Number=3
- The new Page 1 will be used for Overall Summary comments

⚠️ FINAL REMINDER - VALID JSON OUTPUT REQUIRED ⚠️
- All coordinate values must be PURE DECIMAL NUMBERS between 0.0 and 1.0
- NEVER insert words, adjectives, or any text inside coordinate arrays
- NEVER let content from one JSON field leak into another field
- Keep "text" field content COMPLETELY SEPARATE from "Coordinates" array
- Example: [0.12, 0.45, 0.89, 0.52] ✓ CORRECT
- Example: [0 astounding, 0.45, 0.89, 0.52] ✗ WRONG - will break JSON parsing
- Example: [0.12, 0.45, विशेषाधिकार, 0.52] ✗ WRONG - Hindi text in coordinates
- The output must be valid, parseable JSON with no syntax errors

⚠️ SELF-CHECK BEFORE RETURNING RESPONSE:
1. Verify every "Coordinates" array has exactly 4 decimal numbers
2. Verify no text content appears inside any coordinate array
3. Verify the JSON is syntactically valid and can be parsed

